{% load static %}
{% block header %}
<!-- <header class="bg-green-700 text-white w-full"> -->
  <div class="max-w-7xl mx-auto px-2 py-1 flex flex-col md:flex-row items-center justify-between space-y-3 md:space-y-0">
    <!-- Logo -->
    <div class="flex items-center space-x-2 flex-shrink-0">
      <a href="/" class="flex items-center space-x-2">
        <img src="{% static 'img/logo.png' %}" alt="FarmerHarvest" class="h-8">
        <span class="text-xl font-semibold whitespace-nowrap">Farmer <span class="text-[#FF9933]">HARVEST</span></span>
      </a>
    </div>
    <button id="menu-toggle"
      class="fixed top-2 left-4 z-50 p-1 md:hidden bg-gray-100 rounded shadow">
      <!-- Icon (e.g., 3 lines) -->
      <svg class="w-6 h-6 text-gray-800" fill="none" stroke="currentColor" stroke-width="2"
          viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round"
              d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>

    <!-- Search Bar (now well positioned) -->
    <div class="w-full md:w-auto">
      <form method="GET" action="{% url 'shop' %}?search={search}" class="flex items-center bg-white rounded-md px-2 py-1 text-sm w-full md:w-80">
        <input type="text" name="search"
          placeholder="Search items/types..."
          value="{{ request.GET.search|default:'' }}"
          class="flex-grow px-2 py-1 text-gray-800 focus:outline-none rounded-l-md"
        />
        <button type="submit" class="ml-1 text-blue-600 hover:text-blue-800 font-semibold whitespace-nowrap">
          Search
        </button>
      </form>
    </div>
    <!-- Navigation and Auth/Cart -->
    <nav class="flex flex-wrap items-center justify-end gap-3 text-sm w-full md:w-auto">
      <div class="hidden md:flex space-x-4 items-center">
        <a href="/" class="hover:underline">Home</a>
        <a href="/shop" class="hover:underline">Shop</a>
        <a href="/bulk-buy" class="hover:underline">Bulk Buy</a>
      </div>

      {% if request.user.is_authenticated %}
        <div x-data="{ open: false }" class="relative">
          <button @click="open = !open" class="flex items-center focus:outline-none">
            <img src="https://www.gravatar.com/avatar/00000000000000000000000000000000?d=mp&f=y" alt="Avatar"
              class="h-8 w-8 rounded-full border-2 border-white" />
            <span class="ml-2 hidden sm:inline-block text-sm font-medium text-white">{{ request.user.last_name }}</span>
            <svg class="ml-1 h-4 w-4 text-white" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.584l3.71-4.353a.75.75 0 111.14.976l-4.25 5a.75.75 0 01-1.14 0l-4.25-5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
            </svg>
          </button>
          <div x-show="open" @click.away="open = false" x-transition
            class="absolute right-0 mt-2 w-44 bg-white rounded shadow-lg z-50 text-sm text-gray-700 overflow-hidden">
            {% if request.user.userType == '1' %}
              {% if request.user.userApproved %}
                <a href="{% url 'dashboard' %}" class="flex items-center gap-2 px-4 py-2 hover:bg-gray-100 text-sm text-gray-700">
                  <svg class="h-4 w-4 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M3 3h14v2H3V3zm0 4h14v2H3V7zm0 4h9v2H3v-2zm0 4h14v2H3v-2z"/>
                  </svg> FPO Hub
                </a>
              {% else %}
                <a href="{% url 'profile-auth' %}" class="flex items-center gap-2 px-4 py-2 hover:bg-gray-100 text-sm text-yellow-700">
                  <svg class="h-4 w-4 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9 12h2V8H9v4zm0 4h2v-2H9v2zm1-16C4.477 0 0 4.477 0 10s4.477 10 10 10 10-4.477 10-10S15.523 0 10 0z"/>
                  </svg> Request for FPO Hub
                </a>
              {% endif %}
            {% else %}
              <a href="{% url 'profile' %}" class="flex items-center gap-2 px-4 py-2 hover:bg-gray-100 text-sm text-gray-700">
                <svg class="h-4 w-4 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 10a4 4 0 100-8 4 4 0 000 8zm1 2H9a6 6 0 00-6 6v1h14v-1a6 6 0 00-6-6z" clip-rule="evenodd"/>
                </svg> My Profile
              </a>
            {% endif %}
            <a href="{% url 'orders' %}" class="flex items-center gap-2 px-4 py-2 hover:bg-gray-100 text-sm text-gray-700">
              <!-- ðŸ“¦ Orders Icon -->
              <svg class="h-4 w-4 text-indigo-600" fill="currentColor" viewBox="0 0 20 20">
                <path d="M2 6a2 2 0 012-2h1V3a1 1 0 011-1h6a1 1 0 011 1v1h1a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2V6zm3-1v1h10V5H5zm0 3v7h10V8H5z" />
              </svg>
              My Orders
            </a>

            <a href="{% url 'bulk-buy-orders' %}" class="flex items-center gap-2 px-4 py-2 hover:bg-gray-100 text-sm text-gray-700">
              <!-- ðŸ§º Bulk Buy Icon -->
              <svg class="h-4 w-4 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                <path d="M4 4a1 1 0 000 2h12a1 1 0 100-2H4zm1 3a1 1 0 000 2h10a1 1 0 100-2H5zm-1 4a1 1 0 011-1h10a1 1 0 011 1v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5z" />
              </svg>
              Bulk Buys
            </a>

            <form method="post" action="{% url 'logout' %}" class="border-t">
              {% csrf_token %}
              <button type="submit" class="flex items-center gap-2 w-full text-left px-4 py-2 hover:bg-gray-100 text-sm text-gray-700">
                <!-- ðŸšª Logout Icon -->
                <svg class="h-4 w-4 text-red-600" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M3 3a1 1 0 011-1h6a1 1 0 110 2H5v12h5a1 1 0 110 2H4a1 1 0 01-1-1V3zm13.707 6.293a1 1 0 00-1.414 1.414L17.586 12H9a1 1 0 100 2h8.586l-2.293 2.293a1 1 0 101.414 1.414l4-4a1 1 0 000-1.414l-4-4z" clip-rule="evenodd" />
                </svg>
                Logout
              </button>

            </form>
          </div>
        </div>
      {% else %}
        <a href="/register" class="hover:underline">Register</a>
        <a href="/login" class="hover:underline">Login</a>
      {% endif %}

      <!-- Cart Icon -->
      <a href="{% url 'cart_view' %}" class="relative group inline-block">
        <svg class="h-6 w-6 text-white group-hover:text-gray-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-1.293 2.707a1 1 0 00.293 1.293L7 18h10a1 1 0 001-1l-1-2m-6 4a1 1 0 11-2 0 1 1 0 012 0z" />
        </svg>
        {% if total_cart_qty > 0 %}
        <span class="absolute -top-1 -right-1 bg-red-600 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center shadow-md">
          {{ total_cart_qty }}
        </span>
        {% endif %}
      </a>

      <!-- Pincode Input -->
      <form method="GET" action="{% url 'shop' %}?pin={pincode}" class="flex items-center bg-white rounded px-2 py-1 text-sm ml-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-700 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M12 11c1.656 0 3-1.344 3-3s-1.344-3-3-3-3 1.344-3 3 1.344 3 3 3zM12 2C8.134 2 5 5.134 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.866-3.134-7-7-7z"/>
        </svg>
        <input type="text" name="pincode"
          value="{{ request.session.pincode|default:'' }}"
          placeholder="Pincode"
          pattern="\d{6}"
          maxlength="6"
          class="w-20 text-sm text-gray-800 focus:outline-none text-center"
          title="Enter 6-digit pincode" />
        <button type="submit" class="ml-1 text-green-700 hover:text-green-800 font-medium">Set</button>
      </form>
      <!-- Hamburger Button -->
    </nav>

    <!-- Slide-in Mobile Menu -->
    <div id="mobile-menu" class="fixed top-0 left-0 w-64 h-full bg-[#047857] shadow transform -translate-x-full transition-transform duration-300 ease-in-out z-50 md:hidden">
      <!-- Close Button -->
      <div class="flex justify-end p-4">
        <button id="menu-close" class="text-gray-800">
          <!-- X Icon -->
          <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2"
              viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <!-- Mobile Menu Content -->
      <ul class="p-4 space-y-4">
        <span class="border-b border-gray-700 text-xl font-semibold whitespace-nowrap">Farmer <span class="text-[#FF9933]">HARVEST</span></span>
        <li><a href="/" class="block text-white">Home</a></li>
        <li><a href="/shop" class="block text-white">Shop</a></li>
        <li><a href="/bulk-buy" class="block text-white">Bulk Buy</a></li>
      </ul>
    </div>
     <!-- Gray Overlay -->
    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden md:hidden"></div>


  </div>
  <!-- </header> -->
  <script>
    const toggleBtn = document.getElementById('menu-toggle');
    const closeBtn = document.getElementById('menu-close');
    const mobileMenu = document.getElementById('mobile-menu');
    const overlay = document.getElementById('overlay');

    toggleBtn.addEventListener('click', () => {
      mobileMenu.classList.remove('-translate-x-full');
      overlay.classList.remove('hidden');
    });

    closeBtn.addEventListener('click', () => {
      mobileMenu.classList.add('-translate-x-full');
      overlay.classList.add('hidden');
    });

    // Optional: clicking on overlay also closes menu
    overlay.addEventListener('click', () => {
      mobileMenu.classList.add('-translate-x-full');
      overlay.classList.add('hidden');
    });
  </script>


{% endblock %}
